#
# IMPORTANT NOTE
#
# This chart inherits from our common library chart. You can check the default values/options here:
# https://github.com/bjw-s/helm-charts/blob/main/charts/library/common/values.yaml
#

controllers:
  main:
    replicas: 2
    initContainers:
      get-assets:
        image:
          repository: alpine/git
          tag: latest
          imagePullPolicy: Always
        command: [sh, -c]
        args: |
          git clone -b jyje https://github.com/jyje/homer.git /repo &&
          find /repo/public/assets/ \
            -type f \
            -name "*.dist" \
            -exec rm {} \; &&
          cp -r /repo/public/assets/* /www/assets/
    containers:
      main:
        image:
          repository: b4bz/homer
          tag: v23.10.1
          pullPolicy: Always
        env:
        - name: TZ
          value: Seoul/Asia
        securityContext:
          runAsNonRoot: true
          runAsUser: 1000
          runAsGroup: 1000

service:
  main:
    type: ClusterIP
    ports:
      http:
        port: 8080

ingress:
  main:
    enabled: true
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
    - host: app.jyje.online
      paths:
      - service:
          name: homer
          port: 8080
        path: /
    tls:
    - hosts:
      - app.jyje.online
      secretName: app-letsencrypt-tls

persistence:
  assets:
    enabled: true
    type: emptyDir
    globalMounts:
    - path: /www/assets
